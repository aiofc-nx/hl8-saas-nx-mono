# hybrid-archi æµ‹è¯•è¦†ç›–ç‡è®¡åˆ’

> **åˆ›å»ºæ—¥æœŸ**: 2025-01-27  
> **ç›®æ ‡è¦†ç›–ç‡**: 80%+  
> **å½“å‰çŠ¶æ€**: å¾…è¯„ä¼°  

---

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

### æ€»ä½“ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å½“å‰ | çŠ¶æ€ |
|------|------|------|------|
| è¯­å¥è¦†ç›–ç‡ (Statements) | â‰¥ 80% | TBD | â³ |
| åˆ†æ”¯è¦†ç›–ç‡ (Branches) | â‰¥ 75% | TBD | â³ |
| å‡½æ•°è¦†ç›–ç‡ (Functions) | â‰¥ 80% | TBD | â³ |
| è¡Œè¦†ç›–ç‡ (Lines) | â‰¥ 80% | TBD | â³ |

### åˆ†å±‚ç›®æ ‡

| å±‚æ¬¡ | è¯­å¥è¦†ç›–ç‡ | ä¼˜å…ˆçº§ |
|------|-----------|--------|
| é¢†åŸŸå±‚ (Domain) | â‰¥ 90% | ğŸ”´ æœ€é«˜ |
| åº”ç”¨å±‚ (Application) | â‰¥ 85% | ğŸ”´ æœ€é«˜ |
| åŸºç¡€è®¾æ–½å±‚ (Infrastructure) | â‰¥ 75% | ğŸŸ¡ ä¸­ |
| æ¥å£å±‚ (Interface) | â‰¥ 70% | ğŸŸ¢ ä½ |

---

## ğŸ” å½“å‰æµ‹è¯•çŠ¶æ€åˆ†æ

### å·²æœ‰æµ‹è¯•æ–‡ä»¶ç»Ÿè®¡

åŸºäºä»£ç åº“æ‰«æï¼Œå·²å‘ç°ä»¥ä¸‹æµ‹è¯•æ–‡ä»¶ï¼š

#### é¢†åŸŸå±‚æµ‹è¯•

```
âœ… domain/entities/base/base-entity.spec.ts
âœ… domain/aggregates/base/base-aggregate-root.spec.ts
âœ… domain/value-objects/base-value-object.spec.ts
âœ… domain/value-objects/entity-id.spec.ts
âœ… domain/value-objects/ids/tenant-id.vo.spec.ts
âœ… domain/value-objects/ids/user-id.vo.spec.ts
```

#### åº”ç”¨å±‚æµ‹è¯•

```
âœ… application/cqrs/bus/command-bus.spec.ts
âœ… application/cqrs/bus/query-bus.spec.ts
âœ… application/cqrs/bus/event-bus.spec.ts
âœ… application/cqrs/bus/cqrs-bus.spec.ts
âœ… application/cqrs/commands/base/base-command.spec.ts
âœ… application/cqrs/queries/base/base-query-result.spec.ts
âœ… application/cqrs/sagas/core-saga-manager.spec.ts
```

#### åŸºç¡€è®¾æ–½å±‚æµ‹è¯•

```
âœ… infrastructure/adapters/cache/cache.adapter.spec.ts
âœ… infrastructure/adapters/database/database.adapter.spec.ts
âœ… infrastructure/adapters/ports/logger-port.adapter.spec.ts
âœ… infrastructure/performance/cache-strategy.spec.ts
```

#### é›†æˆæµ‹è¯•

```
âœ… __tests__/integration/user-management.integration.spec.ts
âœ… __tests__/infrastructure/e2e/infrastructure.e2e.spec.ts
âœ… __tests__/infrastructure/integration/adapters/cache/
âœ… __tests__/infrastructure/integration/adapters/ports/
```

---

## ğŸ“‹ æµ‹è¯•è¦†ç›–ç‡æ”¹è¿›è®¡åˆ’

### é˜¶æ®µ 1: è¯„ä¼°ç°çŠ¶ï¼ˆ1å‘¨ï¼‰

**ç›®æ ‡**: ç”Ÿæˆè¯¦ç»†çš„è¦†ç›–ç‡æŠ¥å‘Šï¼Œè¯†åˆ«æµ‹è¯•ç¼ºå£

#### ä»»åŠ¡æ¸…å•

- [ ] è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

  ```bash
  nx test hybrid-archi --coverage
  ```

- [ ] ç”Ÿæˆè¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Š

  ```bash
  nx test hybrid-archi --coverage --coverageReporters=html --coverageReporters=text --coverageReporters=json-summary
  ```

- [ ] åˆ†æè¦†ç›–ç‡æŠ¥å‘Š
  - æŸ¥çœ‹ `coverage/index.html`
  - è¯†åˆ«è¦†ç›–ç‡ä½äº 80% çš„æ–‡ä»¶
  - åˆ—å‡ºæœªæµ‹è¯•çš„å‡½æ•°å’Œåˆ†æ”¯

- [ ] åˆ›å»ºæµ‹è¯•ç¼ºå£æ¸…å•
  - æŒ‰ä¼˜å…ˆçº§æ’åº
  - ä¼°ç®—æµ‹è¯•å·¥ä½œé‡
  - åˆ†é…è´£ä»»äºº

#### é¢„æœŸè¾“å‡º

```
coverage/
â”œâ”€â”€ index.html          # HTML è¦†ç›–ç‡æŠ¥å‘Š
â”œâ”€â”€ lcov.info           # LCOV æ ¼å¼æŠ¥å‘Š
â”œâ”€â”€ coverage-summary.json  # JSON æ‘˜è¦
â””â”€â”€ TEST-GAPS.md        # æµ‹è¯•ç¼ºå£æ¸…å•
```

### é˜¶æ®µ 2: è¡¥å……æ ¸å¿ƒæµ‹è¯•ï¼ˆ2å‘¨ï¼‰

**ç›®æ ‡**: è¡¥å……é¢†åŸŸå±‚å’Œåº”ç”¨å±‚çš„æ ¸å¿ƒæµ‹è¯•

#### ä¼˜å…ˆçº§ ğŸ”´ æœ€é«˜

**é¢†åŸŸå±‚æ ¸å¿ƒç»„ä»¶**

- [ ] å€¼å¯¹è±¡æµ‹è¯•è¡¥å……
  - [ ] æ‰€æœ‰å€¼å¯¹è±¡çš„éªŒè¯é€»è¾‘
  - [ ] ç›¸ç­‰æ€§æ¯”è¾ƒè¾¹ç•Œæƒ…å†µ
  - [ ] åºåˆ—åŒ–/ååºåˆ—åŒ–

- [ ] å®ä½“æµ‹è¯•è¡¥å……
  - [ ] å®ä½“ç”Ÿå‘½å‘¨æœŸ
  - [ ] ä¸šåŠ¡æ–¹æ³•æµ‹è¯•
  - [ ] å®¡è®¡ä¿¡æ¯æµ‹è¯•

- [ ] èšåˆæ ¹æµ‹è¯•è¡¥å……
  - [ ] ä¸€è‡´æ€§è¾¹ç•ŒéªŒè¯
  - [ ] é¢†åŸŸäº‹ä»¶å‘å¸ƒ
  - [ ] ç‰ˆæœ¬æ§åˆ¶

**åº”ç”¨å±‚æ ¸å¿ƒç»„ä»¶**

- [ ] CQRS æ€»çº¿æµ‹è¯•è¡¥å……
  - [ ] å‘½ä»¤å¤„ç†æµç¨‹
  - [ ] æŸ¥è¯¢å¤„ç†æµç¨‹
  - [ ] äº‹ä»¶å‘å¸ƒæµç¨‹
  - [ ] é”™è¯¯å¤„ç†

- [ ] ç”¨ä¾‹æµ‹è¯•è¡¥å……
  - [ ] ç”¨ä¾‹æ³¨å†Œ
  - [ ] ç”¨ä¾‹æ‰§è¡Œ
  - [ ] æƒé™éªŒè¯

#### æµ‹è¯•æ¨¡æ¿

```typescript
// é¢†åŸŸå®ä½“æµ‹è¯•æ¨¡æ¿
describe('EntityName', () => {
  describe('åˆ›å»º', () => {
    it('åº”è¯¥èƒ½å¤Ÿåˆ›å»ºæœ‰æ•ˆå®ä½“', () => {
      // Arrange
      const validData = {...};
      
      // Act
      const entity = EntityName.create(validData);
      
      // Assert
      expect(entity).toBeDefined();
      expect(entity.id).toBeDefined();
    });

    it('åº”è¯¥åœ¨æ— æ•ˆæ•°æ®æ—¶æŠ›å‡ºå¼‚å¸¸', () => {
      // Arrange
      const invalidData = {...};
      
      // Act & Assert
      expect(() => EntityName.create(invalidData)).toThrow();
    });
  });

  describe('ä¸šåŠ¡æ–¹æ³•', () => {
    it('åº”è¯¥æ­£ç¡®æ‰§è¡Œä¸šåŠ¡é€»è¾‘', () => {
      // ... æµ‹è¯•å®ç°
    });
  });
});
```

### é˜¶æ®µ 3: é›†æˆæµ‹è¯•ï¼ˆ1å‘¨ï¼‰

**ç›®æ ‡**: è¡¥å……è·¨å±‚é›†æˆæµ‹è¯•

#### ä»»åŠ¡æ¸…å•

- [ ] CQRS å®Œæ•´æµç¨‹æµ‹è¯•
  - [ ] å‘½ä»¤ â†’ èšåˆæ ¹ â†’ äº‹ä»¶
  - [ ] æŸ¥è¯¢ â†’ è¯»æ¨¡å‹ â†’ ç»“æœ
  - [ ] äº‹ä»¶ â†’ æŠ•å½±å™¨ â†’ è¯»æ¨¡å‹

- [ ] äº‹ä»¶æº¯æºæµ‹è¯•
  - [ ] äº‹ä»¶å­˜å‚¨ â†’ äº‹ä»¶è¯»å–
  - [ ] èšåˆæ ¹çŠ¶æ€é‡å»º
  - [ ] å¿«ç…§æœºåˆ¶

- [ ] å¤šç§Ÿæˆ·éš”ç¦»æµ‹è¯•
  - [ ] æ•°æ®éš”ç¦»
  - [ ] ä¸Šä¸‹æ–‡æ³¨å…¥
  - [ ] æƒé™éªŒè¯

### é˜¶æ®µ 4: æ€§èƒ½æµ‹è¯•ï¼ˆ1å‘¨ï¼‰

**ç›®æ ‡**: æ·»åŠ æ€§èƒ½å’Œå‹åŠ›æµ‹è¯•

#### ä»»åŠ¡æ¸…å•

- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
  - [ ] å‘½ä»¤å¤„ç†ååé‡
  - [ ] æŸ¥è¯¢å“åº”æ—¶é—´
  - [ ] äº‹ä»¶å¤„ç†å»¶è¿Ÿ

- [ ] å‹åŠ›æµ‹è¯•
  - [ ] å¹¶å‘å‘½ä»¤å¤„ç†
  - [ ] é«˜é¢‘æŸ¥è¯¢
  - [ ] å¤§é‡äº‹ä»¶å‘å¸ƒ

- [ ] å†…å­˜æ³„æ¼æµ‹è¯•
  - [ ] é•¿æ—¶é—´è¿è¡Œæµ‹è¯•
  - [ ] å†…å­˜ä½¿ç”¨ç›‘æ§

---

## ğŸ› ï¸ æµ‹è¯•å·¥å…·å’Œé…ç½®

### Jest é…ç½®

```json
{
  "jest": {
    "preset": "ts-jest",
    "testEnvironment": "node",
    "roots": ["<rootDir>/src"],
    "testMatch": [
      "**/__tests__/**/*.spec.ts",
      "**/?(*.)+(spec|test).ts"
    ],
    "collectCoverageFrom": [
      "src/**/*.ts",
      "!src/**/*.spec.ts",
      "!src/**/*.d.ts",
      "!src/**/index.ts",
      "!src/examples/**"
    ],
    "coverageDirectory": "coverage",
    "coverageReporters": ["text", "lcov", "html", "json-summary"],
    "coverageThresholds": {
      "global": {
        "branches": 75,
        "functions": 80,
        "lines": 80,
        "statements": 80
      }
    }
  }
}
```

### è¿è¡Œæµ‹è¯•çš„å‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
nx test hybrid-archi

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
nx test hybrid-archi --coverage

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
nx test hybrid-archi --testFile=base-entity.spec.ts

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
nx test hybrid-archi --watch

# è¿è¡Œé›†æˆæµ‹è¯•
nx test hybrid-archi --testPathPattern=integration

# è¿è¡Œ E2E æµ‹è¯•
nx test hybrid-archi --testPathPattern=e2e
```

### CI/CD é›†æˆ

```yaml
# .github/workflows/test.yml
name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: pnpm install
      
      - name: Run tests with coverage
        run: nx test hybrid-archi --coverage
      
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          files: ./coverage/lcov.info
          flags: hybrid-archi
      
      - name: Check coverage thresholds
        run: |
          COVERAGE=$(cat coverage/coverage-summary.json | jq '.total.lines.pct')
          if (( $(echo "$COVERAGE < 80" | bc -l) )); then
            echo "Coverage $COVERAGE% is below 80%"
            exit 1
          fi
```

---

## ğŸ“ˆ æµ‹è¯•æŒ‡æ ‡ç›‘æ§

### å®šæœŸæŠ¥å‘Š

æ¯å‘¨ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼ŒåŒ…å«ï¼š

1. **è¦†ç›–ç‡è¶‹åŠ¿**
   - å„å±‚è¦†ç›–ç‡å˜åŒ–
   - æ–°å¢ä»£ç è¦†ç›–ç‡
   - æœªè¦†ç›–ä»£ç æ¸…å•

2. **æµ‹è¯•è´¨é‡**
   - æµ‹è¯•æ•°é‡
   - æµ‹è¯•æ‰§è¡Œæ—¶é—´
   - æµ‹è¯•ç¨³å®šæ€§ï¼ˆå¤±è´¥ç‡ï¼‰

3. **é—®é¢˜è¿½è¸ª**
   - æœªä¿®å¤çš„æµ‹è¯•å¤±è´¥
   - è·³è¿‡çš„æµ‹è¯•ï¼ˆskip/todoï¼‰
   - æµ‹è¯•æŠ€æœ¯å€ºåŠ¡

### è¦†ç›–ç‡çœ‹æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æµ‹è¯•è¦†ç›–ç‡çœ‹æ¿                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ€»ä½“è¦†ç›–ç‡:        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  85%  âœ…                â”‚
â”‚  é¢†åŸŸå±‚:            â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘  90%  âœ…                â”‚
â”‚  åº”ç”¨å±‚:            â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  80%  âœ…                â”‚
â”‚  åŸºç¡€è®¾æ–½å±‚:        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  70%  âš ï¸                â”‚
â”‚  æ¥å£å±‚:            â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  60%  âŒ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æµ‹è¯•æ•°é‡:          397 ä¸ª                               â”‚
â”‚  é€šè¿‡ç‡:            98.5%                                â”‚
â”‚  å¹³å‡æ‰§è¡Œæ—¶é—´:      2.5 ç§’                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… æˆåŠŸæ ‡å‡†

### æœ€ä½è¦æ±‚ï¼ˆå¿…é¡»è¾¾åˆ°ï¼‰

- âœ… æ€»ä½“è¯­å¥è¦†ç›–ç‡ â‰¥ 80%
- âœ… é¢†åŸŸå±‚è¦†ç›–ç‡ â‰¥ 90%
- âœ… æ‰€æœ‰å…³é”®ä¸šåŠ¡é€»è¾‘æœ‰æµ‹è¯•
- âœ… æ‰€æœ‰å…¬å…± API æœ‰æµ‹è¯•
- âœ… CI/CD é›†æˆæµ‹è¯•è‡ªåŠ¨è¿è¡Œ

### ä¼˜ç§€æ ‡å‡†ï¼ˆåŠªåŠ›æ–¹å‘ï¼‰

- ğŸŒŸ æ€»ä½“è¯­å¥è¦†ç›–ç‡ â‰¥ 90%
- ğŸŒŸ åˆ†æ”¯è¦†ç›–ç‡ â‰¥ 85%
- ğŸŒŸ  æ‰€æœ‰è¾¹ç•Œæƒ…å†µæœ‰æµ‹è¯•
- ğŸŒŸ æ€§èƒ½æµ‹è¯•è¦†ç›–å…³é”®è·¯å¾„
- ğŸŒŸ æµ‹è¯•æ‰§è¡Œæ—¶é—´ < 30 ç§’

---

## ğŸ“ è´Ÿè´£äººå’Œæ—¶é—´è¡¨

| é˜¶æ®µ | è´Ÿè´£äºº | é¢„è®¡å®Œæˆæ—¶é—´ | çŠ¶æ€ |
|------|--------|-------------|------|
| é˜¶æ®µ 1: è¯„ä¼°ç°çŠ¶ | æµ‹è¯•å›¢é˜Ÿ | ç¬¬ 1 å‘¨ | â³ å¾…å¼€å§‹ |
| é˜¶æ®µ 2: è¡¥å……æ ¸å¿ƒæµ‹è¯• | å¼€å‘å›¢é˜Ÿ | ç¬¬ 2-3 å‘¨ | â³ å¾…å¼€å§‹ |
| é˜¶æ®µ 3: é›†æˆæµ‹è¯• | QA å›¢é˜Ÿ | ç¬¬ 4 å‘¨ | â³ å¾…å¼€å§‹ |
| é˜¶æ®µ 4: æ€§èƒ½æµ‹è¯• | æ€§èƒ½å›¢é˜Ÿ | ç¬¬ 5 å‘¨ | â³ å¾…å¼€å§‹ |

---

**æ–‡æ¡£ç»´æŠ¤**: HL8 æµ‹è¯•å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-01-27  
**ç‰ˆæœ¬**: 1.0.0
