# é¢†åŸŸå±‚è®¾è®¡æ–¹æ¡ˆ

> **ç‰ˆæœ¬**: 1.0.0  
> **æ›´æ–°æ—¥æœŸ**: 2025-01-01  
> **é€‚ç”¨èŒƒå›´**: HL8 SAAS å¹³å°é¢†åŸŸå±‚è®¾è®¡

---

## ğŸ“‹ ç›®å½•

- [1. é¢†åŸŸå±‚æ¦‚è¿°](#1-é¢†åŸŸå±‚æ¦‚è¿°)
- [2. é¢†åŸŸå±‚æ¶æ„è®¾è®¡](#2-é¢†åŸŸå±‚æ¶æ„è®¾è®¡)
- [3. æ ¸å¿ƒç»„ä»¶è®¾è®¡](#3-æ ¸å¿ƒç»„ä»¶è®¾è®¡)
- [4. å®ä½“ä¸èšåˆè®¾è®¡](#4-å®ä½“ä¸èšåˆè®¾è®¡)
- [5. å€¼å¯¹è±¡è®¾è®¡](#5-å€¼å¯¹è±¡è®¾è®¡)
- [6. é¢†åŸŸæœåŠ¡è®¾è®¡](#6-é¢†åŸŸæœåŠ¡è®¾è®¡)
- [7. é¢†åŸŸäº‹ä»¶è®¾è®¡](#7-é¢†åŸŸäº‹ä»¶è®¾è®¡)
- [8. ä»“å‚¨æ¥å£è®¾è®¡](#8-ä»“å‚¨æ¥å£è®¾è®¡)
- [9. é¢†åŸŸå±‚å®ç°è§„èŒƒ](#9-é¢†åŸŸå±‚å®ç°è§„èŒƒ)
- [10. æµ‹è¯•ç­–ç•¥](#10-æµ‹è¯•ç­–ç•¥)

---

## 1. é¢†åŸŸå±‚æ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

é¢†åŸŸå±‚æ˜¯ HL8 SAAS å¹³å°çš„æ ¸å¿ƒï¼Œæ‰¿è½½ç€æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å’Œä¸šåŠ¡è§„åˆ™ã€‚åŸºäºé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰å’Œå……è¡€æ¨¡å‹ç†è®ºï¼Œæˆ‘ä»¬çš„é¢†åŸŸå±‚è®¾è®¡ç›®æ ‡åŒ…æ‹¬ï¼š

#### æ ¸å¿ƒç›®æ ‡

1. **ä¸šåŠ¡é€»è¾‘é›†ä¸­åŒ–**
   - å°†ä¸šåŠ¡è§„åˆ™å°è£…åœ¨é¢†åŸŸå¯¹è±¡ä¸­
   - é¿å…ä¸šåŠ¡é€»è¾‘åˆ†æ•£åœ¨æœåŠ¡å±‚
   - ç¡®ä¿ä¸šåŠ¡è§„åˆ™çš„ä¸€è‡´æ€§å’Œå¯å¤ç”¨æ€§

2. **é«˜å†…èšä½è€¦åˆ**
   - é¢†åŸŸå¯¹è±¡å†…éƒ¨é«˜åº¦å†…èš
   - é€šè¿‡æ¥å£å®ç°ä¾èµ–å€’ç½®
   - æœ€å°åŒ–å¯¹å¤–éƒ¨ä¾èµ–

3. **ä¸šåŠ¡è¯­è¨€è¡¨è¾¾**
   - ä½¿ç”¨ä¸šåŠ¡æœ¯è¯­å‘½å
   - ä»£ç ç»“æ„åæ˜ ä¸šåŠ¡ç»“æ„
   - ä¾¿äºä¸šåŠ¡äººå‘˜ç†è§£

4. **å¯æµ‹è¯•æ€§**
   - çº¯é¢†åŸŸé€»è¾‘ï¼Œæ— å¤–éƒ¨ä¾èµ–
   - å¯ç‹¬ç«‹è¿›è¡Œå•å…ƒæµ‹è¯•
   - å¿«é€Ÿåé¦ˆä¸šåŠ¡è§„åˆ™æ­£ç¡®æ€§

### 1.2 è®¾è®¡åŸåˆ™

#### å……è¡€æ¨¡å‹åŸåˆ™

- **ä¸šåŠ¡é€»è¾‘åœ¨å®ä½“å†…**: å®ä½“åŒ…å«æ•°æ®å’Œè¡Œä¸º
- **å°è£…å†…éƒ¨çŠ¶æ€**: é€šè¿‡æ–¹æ³•æš´éœ²è¡Œä¸ºï¼Œéšè—å®ç°ç»†èŠ‚
- **è‡ªæˆ‘éªŒè¯**: å®ä½“ä¿è¯è‡ªèº«çŠ¶æ€å§‹ç»ˆæœ‰æ•ˆ
- **è¡Œä¸ºé©±åŠ¨**: é€šè¿‡ä¸šåŠ¡æ–¹æ³•æ”¹å˜çŠ¶æ€

#### èšåˆè®¾è®¡åŸåˆ™

- **èšåˆè¾¹ç•Œ**: æ˜ç¡®çš„ä¸šåŠ¡è¾¹ç•Œ
- **äº‹åŠ¡è¾¹ç•Œ**: ä¸€ä¸ªäº‹åŠ¡åªä¿®æ”¹ä¸€ä¸ªèšåˆ
- **ä¸€è‡´æ€§è¾¹ç•Œ**: èšåˆå†…å¼ºä¸€è‡´æ€§ï¼Œèšåˆé—´æœ€ç»ˆä¸€è‡´æ€§
- **æœ€å°åŒ–èšåˆ**: ä¿æŒèšåˆå°½å¯èƒ½å°

#### ä¾èµ–è§„åˆ™

- **ä¾èµ–å€’ç½®**: é¢†åŸŸå±‚å®šä¹‰æ¥å£ï¼ŒåŸºç¡€è®¾æ–½å±‚å®ç°
- **æ— æ¡†æ¶ä¾èµ–**: é¢†åŸŸå±‚ä¸ä¾èµ–ä»»ä½•æ¡†æ¶
- **çº¯ TypeScript**: ä½¿ç”¨åŸç”Ÿ TypeScript ç‰¹æ€§

---

## 2. é¢†åŸŸå±‚æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

```text
é¢†åŸŸå±‚ (Domain Layer)
â”œâ”€â”€ å®ä½“ (Entities)
â”‚   â”œâ”€â”€ åŸºç¡€å®ä½“ (BaseEntity)
â”‚   â”œâ”€â”€ èšåˆæ ¹ (AggregateRoot)
â”‚   â””â”€â”€ é¢†åŸŸå®ä½“ (Domain Entities)
â”œâ”€â”€ å€¼å¯¹è±¡ (Value Objects)
â”‚   â”œâ”€â”€ åŸºç¡€å€¼å¯¹è±¡ (BaseValueObject)
â”‚   â”œâ”€â”€ æ ‡è¯†ç¬¦ (Identifiers)
â”‚   â””â”€â”€ ä¸šåŠ¡å€¼å¯¹è±¡ (Business Value Objects)
â”œâ”€â”€ é¢†åŸŸæœåŠ¡ (Domain Services)
â”‚   â”œâ”€â”€ è®¡ç®—æœåŠ¡ (Calculation Services)
â”‚   â”œâ”€â”€ éªŒè¯æœåŠ¡ (Validation Services)
â”‚   â””â”€â”€ ç­–ç•¥æœåŠ¡ (Strategy Services)
â”œâ”€â”€ é¢†åŸŸäº‹ä»¶ (Domain Events)
â”‚   â”œâ”€â”€ åŸºç¡€äº‹ä»¶ (BaseDomainEvent)
â”‚   â””â”€â”€ ä¸šåŠ¡äº‹ä»¶ (Business Events)
â”œâ”€â”€ ä»“å‚¨æ¥å£ (Repository Interfaces)
â”‚   â”œâ”€â”€ èšåˆä»“å‚¨ (Aggregate Repositories)
â”‚   â””â”€â”€ æŸ¥è¯¢ä»“å‚¨ (Query Repositories)
â”œâ”€â”€ å¼‚å¸¸ (Exceptions)
â”‚   â”œâ”€â”€ é¢†åŸŸå¼‚å¸¸ (Domain Exceptions)
â”‚   â””â”€â”€ ä¸šåŠ¡å¼‚å¸¸ (Business Exceptions)
â””â”€â”€ è§„èŒƒ (Specifications)
    â”œâ”€â”€ ä¸šåŠ¡è§„èŒƒ (Business Specifications)
    â””â”€â”€ æŸ¥è¯¢è§„èŒƒ (Query Specifications)
```

### 2.2 åŒ…ç»“æ„è®¾è®¡

```text
libs/{domain}/src/lib/
â”œâ”€â”€ entities/                    # å®ä½“
â”‚   â”œâ”€â”€ base/                   # åŸºç¡€å®ä½“
â”‚   â”‚   â”œâ”€â”€ base-entity.ts      # åŸºç¡€å®ä½“ç±»
â”‚   â”‚   â”œâ”€â”€ aggregate-root.ts   # èšåˆæ ¹åŸºç±»
â”‚   â”‚   â””â”€â”€ entity-id.ts        # å®ä½“æ ‡è¯†ç¬¦
â”‚   â”œâ”€â”€ user/                   # ç”¨æˆ·å®ä½“
â”‚   â”‚   â”œâ”€â”€ user.entity.ts      # ç”¨æˆ·å®ä½“
â”‚   â”‚   â”œâ”€â”€ user-status.ts      # ç”¨æˆ·çŠ¶æ€
â”‚   â”‚   â””â”€â”€ user.repository.interface.ts
â”‚   â””â”€â”€ tenant/                 # ç§Ÿæˆ·å®ä½“
â”‚       â”œâ”€â”€ tenant.entity.ts    # ç§Ÿæˆ·å®ä½“
â”‚       â”œâ”€â”€ tenant-type.ts      # ç§Ÿæˆ·ç±»å‹
â”‚       â””â”€â”€ tenant.repository.interface.ts
â”œâ”€â”€ value-objects/              # å€¼å¯¹è±¡
â”‚   â”œâ”€â”€ base/                   # åŸºç¡€å€¼å¯¹è±¡
â”‚   â”‚   â””â”€â”€ base-value-object.ts
â”‚   â”œâ”€â”€ identifiers/            # æ ‡è¯†ç¬¦
â”‚   â”‚   â”œâ”€â”€ user-id.ts
â”‚   â”‚   â””â”€â”€ tenant-id.ts
â”‚   â””â”€â”€ business/               # ä¸šåŠ¡å€¼å¯¹è±¡
â”‚       â”œâ”€â”€ email.ts
â”‚       â”œâ”€â”€ phone.ts
â”‚       â””â”€â”€ address.ts
â”œâ”€â”€ services/                   # é¢†åŸŸæœåŠ¡
â”‚   â”œâ”€â”€ user/                   # ç”¨æˆ·ç›¸å…³æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ user-domain.service.ts
â”‚   â”‚   â””â”€â”€ user-creation.service.ts
â”‚   â””â”€â”€ tenant/                 # ç§Ÿæˆ·ç›¸å…³æœåŠ¡
â”‚       â”œâ”€â”€ tenant-domain.service.ts
â”‚       â””â”€â”€ tenant-provisioning.service.ts
â”œâ”€â”€ events/                     # é¢†åŸŸäº‹ä»¶
â”‚   â”œâ”€â”€ base/                   # åŸºç¡€äº‹ä»¶
â”‚   â”‚   â””â”€â”€ base-domain-event.ts
â”‚   â”œâ”€â”€ user/                   # ç”¨æˆ·äº‹ä»¶
â”‚   â”‚   â”œâ”€â”€ user-created.event.ts
â”‚   â”‚   â””â”€â”€ user-activated.event.ts
â”‚   â””â”€â”€ tenant/                 # ç§Ÿæˆ·äº‹ä»¶
â”‚       â”œâ”€â”€ tenant-created.event.ts
â”‚       â””â”€â”€ tenant-activated.event.ts
â”œâ”€â”€ exceptions/                 # å¼‚å¸¸
â”‚   â”œâ”€â”€ domain/                 # é¢†åŸŸå¼‚å¸¸
â”‚   â”‚   â””â”€â”€ domain-exception.ts
â”‚   â””â”€â”€ business/               # ä¸šåŠ¡å¼‚å¸¸
â”‚       â”œâ”€â”€ user/               # ç”¨æˆ·å¼‚å¸¸
â”‚       â”‚   â”œâ”€â”€ user-not-found.exception.ts
â”‚       â”‚   â””â”€â”€ user-already-exists.exception.ts
â”‚       â””â”€â”€ tenant/             # ç§Ÿæˆ·å¼‚å¸¸
â”‚           â”œâ”€â”€ tenant-not-found.exception.ts
â”‚           â””â”€â”€ tenant-limit-exceeded.exception.ts
â”œâ”€â”€ specifications/             # è§„èŒƒ
â”‚   â”œâ”€â”€ user/                   # ç”¨æˆ·è§„èŒƒ
â”‚   â”‚   â”œâ”€â”€ user-creation.specification.ts
â”‚   â”‚   â””â”€â”€ user-activation.specification.ts
â”‚   â””â”€â”€ tenant/                 # ç§Ÿæˆ·è§„èŒƒ
â”‚       â”œâ”€â”€ tenant-creation.specification.ts
â”‚       â””â”€â”€ tenant-provisioning.specification.ts
â””â”€â”€ constants.ts                # å¸¸é‡å®šä¹‰
```

---

## 3. æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 3.1 åŸºç¡€å®ä½“è®¾è®¡

#### BaseEntity

```typescript
/**
 * åŸºç¡€å®ä½“ç±»
 *
 * æ‰€æœ‰é¢†åŸŸå®ä½“çš„åŸºç±»ï¼Œæä¾›å®ä½“çš„ä¸€è‡´è¡Œä¸º
 * åŒ…æ‹¬å”¯ä¸€æ ‡è¯†ç¬¦ã€åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ç­‰åŸºç¡€å±æ€§
 *
 * @description å®ä½“æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå…·æœ‰å”¯ä¸€æ ‡è¯†ç¬¦å’Œç”Ÿå‘½å‘¨æœŸ
 * å®ä½“çš„ç›¸ç­‰æ€§åŸºäºå…¶æ ‡è¯†ç¬¦ï¼Œè€Œä¸æ˜¯å±æ€§å€¼
 *
 * ## ä¸šåŠ¡è§„åˆ™
 *
 * ### æ ‡è¯†ç¬¦è§„åˆ™
 * - æ¯ä¸ªå®ä½“å¿…é¡»å…·æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦
 * - æ ‡è¯†ç¬¦åœ¨å®ä½“ç”Ÿå‘½å‘¨æœŸå†…ä¸å¯å˜æ›´
 * - æ ‡è¯†ç¬¦ç”¨äºå®ä½“çš„ç›¸ç­‰æ€§æ¯”è¾ƒ
 * - æ ‡è¯†ç¬¦å¿…é¡»ç¬¦åˆEntityIdçš„æ ¼å¼è¦æ±‚
 *
 * ### æ—¶é—´æˆ³è§„åˆ™
 * - åˆ›å»ºæ—¶é—´åœ¨å®ä½“åˆ›å»ºæ—¶è®¾ç½®ï¼Œä¸å¯ä¿®æ”¹
 * - æ›´æ–°æ—¶é—´åœ¨å®ä½“çŠ¶æ€å˜æ›´æ—¶è‡ªåŠ¨æ›´æ–°
 * - æ—¶é—´æˆ³é‡‡ç”¨UTCæ—¶åŒºï¼Œç¡®ä¿è·¨æ—¶åŒºä¸€è‡´æ€§
 * - æ—¶é—´æˆ³ç²¾åº¦åˆ°æ¯«ç§’çº§åˆ«
 *
 * ### ç›¸ç­‰æ€§è§„åˆ™
 * - å®ä½“çš„ç›¸ç­‰æ€§åŸºäºæ ‡è¯†ç¬¦æ¯”è¾ƒï¼Œè€Œéå±æ€§å€¼
 * - ç›¸åŒç±»å‹ä¸”ç›¸åŒæ ‡è¯†ç¬¦çš„å®ä½“è¢«è§†ä¸ºç›¸ç­‰
 * - ä¸åŒç±»å‹ä½†ç›¸åŒæ ‡è¯†ç¬¦çš„å®ä½“è¢«è§†ä¸ºä¸ç›¸ç­‰
 * - nullå’Œundefinedä¸ä»»ä½•å®ä½“éƒ½ä¸ç›¸ç­‰
 *
 * @example
 * ```typescript
 * class User extends BaseEntity {
 *   constructor(
 *     id: EntityId,
 *     private name: string,
 *     private email: string
 *   ) {
 *     super(id);
 *   }
 *
 *   getName(): string {
 *     return this.name;
 *   }
 *
 *   updateName(newName: string): void {
 *     this.name = newName;
 *     this.updateTimestamp(); // è‡ªåŠ¨æ›´æ–°ä¿®æ”¹æ—¶é—´
 *   }
 * }
 *
 * // åˆ›å»ºç”¨æˆ·å®ä½“
 * const user = new User(EntityId.generate(), 'å¼ ä¸‰', 'zhangsan@example.com');
 *
 * // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
 * user.updateName('æå››');
 * ```
 *
 * @since 1.0.0
 */
export abstract class BaseEntity {
  private readonly _id: EntityId;
  private readonly _createdAt: Date;
  private _updatedAt: Date;
  private _domainEvents: DomainEvent[] = [];

  /**
   * æ„é€ å‡½æ•°
   *
   * @param id - å®ä½“å”¯ä¸€æ ‡è¯†ç¬¦
   * @param createdAt - åˆ›å»ºæ—¶é—´ï¼Œå¯é€‰ï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
   * @param updatedAt - æ›´æ–°æ—¶é—´ï¼Œå¯é€‰ï¼Œé»˜è®¤ä¸ºå½“å‰æ—¶é—´
   */
  constructor(id: EntityId, createdAt?: Date, updatedAt?: Date) {
    this._id = id;
    this._createdAt = createdAt || new Date();
    this._updatedAt = updatedAt || new Date();
  }

  /**
   * è·å–å®ä½“æ ‡è¯†ç¬¦
   *
   * @returns å®ä½“å”¯ä¸€æ ‡è¯†ç¬¦
   */
  get id(): EntityId {
    return this._id;
  }

  /**
   * è·å–åˆ›å»ºæ—¶é—´
   *
   * @returns åˆ›å»ºæ—¶é—´
   */
  get createdAt(): Date {
    return this._createdAt;
  }

  /**
   * è·å–æ›´æ–°æ—¶é—´
   *
   * @returns æ›´æ–°æ—¶é—´
   */
  get updatedAt(): Date {
    return this._updatedAt;
  }

  /**
   * æ›´æ–°å®ä½“æ—¶é—´æˆ³
   *
   * @description åœ¨å®ä½“çŠ¶æ€å˜æ›´æ—¶è°ƒç”¨ï¼Œè‡ªåŠ¨æ›´æ–°ä¿®æ”¹æ—¶é—´
   * æ­¤æ–¹æ³•åº”è¯¥åœ¨å®ä½“å†…éƒ¨çŠ¶æ€å˜æ›´çš„æ–¹æ³•ä¸­è°ƒç”¨
   *
   * @example
   * ```typescript
   * updateName(newName: string): void {
   *   this.name = newName;
   *   this.updateTimestamp(); // æ›´æ–°ä¿®æ”¹æ—¶é—´
   * }
   * ```
   */
  protected updateTimestamp(): void {
    this._updatedAt = new Date();
  }

  /**
   * æ·»åŠ é¢†åŸŸäº‹ä»¶
   *
   * @description æ·»åŠ é¢†åŸŸäº‹ä»¶åˆ°å®ä½“çš„å¾…å‘å¸ƒäº‹ä»¶åˆ—è¡¨
   * äº‹ä»¶å°†åœ¨èšåˆæ ¹ä¿å­˜æ—¶å‘å¸ƒ
   *
   * @param event - è¦æ·»åŠ çš„é¢†åŸŸäº‹ä»¶
   *
   * @example
   * ```typescript
   * activate(): void {
   *   this.status = UserStatus.Active;
   *   this.addDomainEvent(new UserActivatedEvent(this.id));
   * }
   * ```
   */
  protected addDomainEvent(event: DomainEvent): void {
    this._domainEvents.push(event);
  }

  /**
   * è·å–æ‰€æœ‰é¢†åŸŸäº‹ä»¶
   *
   * @returns é¢†åŸŸäº‹ä»¶æ•°ç»„
   */
  getDomainEvents(): DomainEvent[] {
    return [...this._domainEvents];
  }

  /**
   * æ¸…é™¤é¢†åŸŸäº‹ä»¶
   *
   * @description åœ¨äº‹ä»¶å‘å¸ƒåè°ƒç”¨ï¼Œæ¸…é™¤å·²å‘å¸ƒçš„äº‹ä»¶
   */
  clearDomainEvents(): void {
    this._domainEvents = [];
  }

  /**
   * æ£€æŸ¥å®ä½“æ˜¯å¦ç›¸ç­‰
   *
   * @param other - è¦æ¯”è¾ƒçš„å¦ä¸€ä¸ªå®ä½“
   * @returns å¦‚æœå®ä½“ç›¸ç­‰è¿”å›trueï¼Œå¦åˆ™è¿”å›false
   *
   * @example
   * ```typescript
   * const user1 = new User(EntityId.generate(), 'å¼ ä¸‰', 'zhangsan@example.com');
   * const user2 = new User(user1.id, 'æå››', 'lisi@example.com');
   * 
   * console.log(user1.equals(user2)); // true (ç›¸åŒID)
   * console.log(user1.equals(user1)); // true (ç›¸åŒå¯¹è±¡)
   * ```
   */
  equals(other: BaseEntity | null | undefined): boolean {
    if (other === null || other === undefined) {
      return false;
    }

    if (this === other) {
      return true;
    }

    if (this.constructor !== other.constructor) {
      return false;
    }

    return this._id.equals(other._id);
  }

  /**
   * è·å–å®ä½“å“ˆå¸Œå€¼
   *
   * @returns åŸºäºæ ‡è¯†ç¬¦çš„å“ˆå¸Œå€¼
   */
  hashCode(): string {
    return this._id.toString();
  }
}
```

---

## 4. å®ä½“ä¸èšåˆè®¾è®¡

### 4.1 èšåˆæ ¹åŸºç±»è®¾è®¡

#### AggregateRoot

```typescript
/**
 * èšåˆæ ¹åŸºç±»
 *
 * èšåˆæ ¹æ˜¯èšåˆçš„å…¥å£ç‚¹ï¼Œè´Ÿè´£ç»´æŠ¤èšåˆçš„ä¸€è‡´æ€§è¾¹ç•Œ
 * èšåˆæ ¹ç»§æ‰¿è‡ªBaseEntityï¼Œå¢åŠ äº†èšåˆç‰¹å®šçš„è¡Œä¸º
 *
 * @description èšåˆæ ¹æ˜¯èšåˆçš„å”¯ä¸€å…¥å£ï¼Œå¤–éƒ¨åªèƒ½é€šè¿‡èšåˆæ ¹è®¿é—®èšåˆå†…çš„å¯¹è±¡
 * èšåˆæ ¹è´Ÿè´£ç»´æŠ¤èšåˆå†…å¯¹è±¡çš„ä¸€è‡´æ€§ï¼Œç¡®ä¿ä¸šåŠ¡è§„åˆ™å¾—åˆ°æ‰§è¡Œ
 *
 * ## ä¸šåŠ¡è§„åˆ™
 *
 * ### èšåˆè¾¹ç•Œè§„åˆ™
 * - èšåˆæ ¹æ˜¯èšåˆçš„å”¯ä¸€å…¥å£ç‚¹
 * - å¤–éƒ¨ä¸èƒ½ç›´æ¥è®¿é—®èšåˆå†…çš„å®ä½“æˆ–å€¼å¯¹è±¡
 * - èšåˆå†…çš„æ‰€æœ‰å¯¹è±¡å˜æ›´å¿…é¡»é€šè¿‡èšåˆæ ¹è¿›è¡Œ
 * - èšåˆæ ¹è´Ÿè´£ç»´æŠ¤èšåˆå†…å¯¹è±¡çš„ä¸€è‡´æ€§
 *
 * ### äº‹åŠ¡è¾¹ç•Œè§„åˆ™
 * - ä¸€ä¸ªäº‹åŠ¡åªèƒ½ä¿®æ”¹ä¸€ä¸ªèšåˆ
 * - èšåˆå†…ä¿è¯å¼ºä¸€è‡´æ€§
 * - èšåˆé—´é€šè¿‡é¢†åŸŸäº‹ä»¶å®ç°æœ€ç»ˆä¸€è‡´æ€§
 * - èšåˆæ ¹è´Ÿè´£å‘å¸ƒé¢†åŸŸäº‹ä»¶
 *
 * ### ç”Ÿå‘½å‘¨æœŸè§„åˆ™
 * - èšåˆæ ¹çš„åˆ›å»ºå’Œé”€æ¯ä»£è¡¨èšåˆçš„ç”Ÿå‘½å‘¨æœŸ
 * - èšåˆæ ¹è´Ÿè´£èšåˆå†…å¯¹è±¡çš„åˆ›å»ºå’Œç®¡ç†
 * - èšåˆæ ¹å¯ä»¥åŒ…å«å¤šä¸ªå®ä½“å’Œå€¼å¯¹è±¡
 *
 * @example
 * ```typescript
 * class OrderAggregateRoot extends AggregateRoot {
 *   private items: OrderItem[] = [];
 *   private customerId: CustomerId;
 *   
 *   constructor(
 *     id: OrderId,
 *     customerId: CustomerId
 *   ) {
 *     super(id);
 *     this.customerId = customerId;
 *   }
 *   
 *   addItem(productId: ProductId, quantity: number, price: Money): void {
 *     // ä¸šåŠ¡è§„åˆ™éªŒè¯
 *     this.ensureIsDraft();
 *     this.ensureValidQuantity(quantity);
 *     
 *     const item = OrderItem.create(productId, quantity, price);
 *     this.items.push(item);
 *     
 *     // ç»´æŠ¤èšåˆä¸€è‡´æ€§
 *     this.recalculateTotal();
 *     
 *     // å‘å¸ƒé¢†åŸŸäº‹ä»¶
 *     this.addDomainEvent(new OrderItemAddedEvent(this.id, item));
 *   }
 * }
 * ```
 *
 * @since 1.0.0
 */
export abstract class AggregateRoot extends BaseEntity {
  private _version: number = 0;

  /**
   * æ„é€ å‡½æ•°
   *
   * @param id - èšåˆæ ¹æ ‡è¯†ç¬¦
   * @param createdAt - åˆ›å»ºæ—¶é—´ï¼Œå¯é€‰
   * @param updatedAt - æ›´æ–°æ—¶é—´ï¼Œå¯é€‰
   * @param version - ç‰ˆæœ¬å·ï¼Œç”¨äºä¹è§‚é”ï¼Œå¯é€‰
   */
  constructor(
    id: EntityId,
    createdAt?: Date,
    updatedAt?: Date,
    version: number = 0
  ) {
    super(id, createdAt, updatedAt);
    this._version = version;
  }

  /**
   * è·å–èšåˆç‰ˆæœ¬å·
   *
   * @returns å½“å‰ç‰ˆæœ¬å·
   */
  get version(): number {
    return this._version;
  }

  /**
   * æ›´æ–°èšåˆç‰ˆæœ¬å·
   *
   * @description åœ¨èšåˆçŠ¶æ€å˜æ›´æ—¶è°ƒç”¨ï¼Œç”¨äºä¹è§‚é”æ§åˆ¶
   * æ­¤æ–¹æ³•åº”è¯¥åœ¨èšåˆçŠ¶æ€å˜æ›´çš„æ–¹æ³•ä¸­è°ƒç”¨
   *
   * @example
   * ```typescript
   * updateStatus(newStatus: OrderStatus): void {
   *   this.status = newStatus;
   *   this.updateTimestamp();
   *   this.incrementVersion(); // æ›´æ–°ç‰ˆæœ¬å·
   * }
   * ```
   */
  protected incrementVersion(): void {
    this._version += 1;
    this.updateTimestamp();
  }

  /**
   * è®¾ç½®èšåˆç‰ˆæœ¬å·
   *
   * @description ä»æŒä¹…åŒ–å±‚æ¢å¤èšåˆæ—¶è°ƒç”¨
   * æ­¤æ–¹æ³•é€šå¸¸ç”±ä»“å‚¨å®ç°è°ƒç”¨
   *
   * @param version - è¦è®¾ç½®çš„ç‰ˆæœ¬å·
   */
  setVersion(version: number): void {
    this._version = version;
  }
}
```

### 4.2 å®ä½“æ ‡è¯†ç¬¦è®¾è®¡

#### EntityId

```typescript
/**
 * å®ä½“æ ‡è¯†ç¬¦åŸºç±»
 *
 * æ‰€æœ‰å®ä½“æ ‡è¯†ç¬¦çš„åŸºç±»ï¼Œæä¾›ç±»å‹å®‰å…¨å’Œå€¼æ¯”è¾ƒåŠŸèƒ½
 * å®ä½“æ ‡è¯†ç¬¦æ˜¯ä¸å¯å˜çš„å€¼å¯¹è±¡ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†å®ä½“
 *
 * @description å®ä½“æ ‡è¯†ç¬¦æ˜¯å®ä½“çš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„å®ä½“å®ä¾‹
 * æ ‡è¯†ç¬¦æ˜¯ä¸å¯å˜çš„ï¼Œä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹
 *
 * ## ä¸šåŠ¡è§„åˆ™
 *
 * ### å”¯ä¸€æ€§è§„åˆ™
 * - æ¯ä¸ªå®ä½“å¿…é¡»æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦
 * - æ ‡è¯†ç¬¦åœ¨å®ä½“ç”Ÿå‘½å‘¨æœŸå†…ä¸å¯å˜æ›´
 * - ä¸åŒå®ä½“çš„æ ‡è¯†ç¬¦å¿…é¡»ä¸åŒ
 * - ç›¸åŒæ ‡è¯†ç¬¦ä»£è¡¨åŒä¸€ä¸ªå®ä½“
 *
 * ### ä¸å¯å˜æ€§è§„åˆ™
 * - æ ‡è¯†ç¬¦ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹
 * - æ ‡è¯†ç¬¦çš„å€¼åœ¨å®ä½“ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜
 * - æ ‡è¯†ç¬¦çš„æ¯”è¾ƒåŸºäºå€¼è€Œéå¼•ç”¨
 *
 * ### ç±»å‹å®‰å…¨è§„åˆ™
 * - ä¸åŒç±»å‹çš„å®ä½“ä½¿ç”¨ä¸åŒç±»å‹çš„æ ‡è¯†ç¬¦
 * - æ ‡è¯†ç¬¦ç±»å‹åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥
 * - é˜²æ­¢ä¸åŒç±»å‹å®ä½“æ ‡è¯†ç¬¦çš„æ··æ·†
 *
 * @example
 * ```typescript
 * class UserId extends EntityId {
 *   constructor(value: string) {
 *     super(value);
 *   }
 *   
 *   static generate(): UserId {
 *     return new UserId(crypto.randomUUID());
 *   }
 * }
 * 
 * class OrderId extends EntityId {
 *   constructor(value: string) {
 *     super(value);
 *   }
 * }
 * 
 * // ç±»å‹å®‰å…¨
 * const userId = UserId.generate();
 * const orderId = new OrderId('order-123');
 * 
 * // userId.equals(orderId); // ç¼–è¯‘é”™è¯¯ï¼Œç±»å‹ä¸åŒ¹é…
 * ```
 *
 * @since 1.0.0
 */
export abstract class EntityId {
  private readonly _value: string;

  /**
   * æ„é€ å‡½æ•°
   *
   * @param value - æ ‡è¯†ç¬¦çš„å­—ç¬¦ä¸²å€¼
   * @throws {InvalidEntityIdException} å½“æ ‡è¯†ç¬¦å€¼æ— æ•ˆæ—¶æŠ›å‡ºå¼‚å¸¸
   */
  constructor(value: string) {
    this.validate(value);
    this._value = value;
  }

  /**
   * è·å–æ ‡è¯†ç¬¦å€¼
   *
   * @returns æ ‡è¯†ç¬¦çš„å­—ç¬¦ä¸²å€¼
   */
  get value(): string {
    return this._value;
  }

  /**
   * éªŒè¯æ ‡è¯†ç¬¦å€¼
   *
   * @param value - è¦éªŒè¯çš„å€¼
   * @throws {InvalidEntityIdException} å½“å€¼æ— æ•ˆæ—¶æŠ›å‡ºå¼‚å¸¸
   */
  protected abstract validate(value: string): void;

  /**
   * æ£€æŸ¥æ ‡è¯†ç¬¦æ˜¯å¦ç›¸ç­‰
   *
   * @param other - è¦æ¯”è¾ƒçš„å¦ä¸€ä¸ªæ ‡è¯†ç¬¦
   * @returns å¦‚æœæ ‡è¯†ç¬¦ç›¸ç­‰è¿”å›trueï¼Œå¦åˆ™è¿”å›false
   */
  equals(other: EntityId | null | undefined): boolean {
    if (other === null || other === undefined) {
      return false;
    }

    if (this === other) {
      return true;
    }

    if (this.constructor !== other.constructor) {
      return false;
    }

    return this._value === other._value;
  }

  /**
   * è½¬æ¢ä¸ºå­—ç¬¦ä¸²
   *
   * @returns æ ‡è¯†ç¬¦çš„å­—ç¬¦ä¸²è¡¨ç¤º
   */
  toString(): string {
    return this._value;
  }

  /**
   * è·å–å“ˆå¸Œå€¼
   *
   * @returns æ ‡è¯†ç¬¦çš„å“ˆå¸Œå€¼
   */
  hashCode(): string {
    return this._value;
  }
}
```

### 4.3 å…·ä½“å®ä½“ç¤ºä¾‹

#### User å®ä½“è®¾è®¡

```typescript
/**
 * ç”¨æˆ·å®ä½“
 *
 * ç”¨æˆ·æ˜¯ç³»ç»Ÿä¸­çš„æ ¸å¿ƒå®ä½“ï¼Œä»£è¡¨ä½¿ç”¨å¹³å°æœåŠ¡çš„ä¸ªäººæˆ–ç»„ç»‡
 * ç”¨æˆ·å®ä½“åŒ…å«ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯å’ŒçŠ¶æ€ç®¡ç†
 *
 * @description ç”¨æˆ·å®ä½“è´Ÿè´£ç®¡ç†ç”¨æˆ·çš„ç”Ÿå‘½å‘¨æœŸã€çŠ¶æ€è½¬æ¢å’Œä¸šåŠ¡è§„åˆ™
 * ç”¨æˆ·å¯ä»¥æ˜¯å¹³å°ç”¨æˆ·æˆ–ç§Ÿæˆ·ç”¨æˆ·ï¼Œå…·æœ‰ä¸åŒçš„æƒé™å’ŒçŠ¶æ€
 *
 * ## ä¸šåŠ¡è§„åˆ™
 *
 * ### ç”¨æˆ·åˆ›å»ºè§„åˆ™
 * - ç”¨æˆ·å¿…é¡»æœ‰æœ‰æ•ˆçš„é‚®ç®±åœ°å€
 * - ç”¨æˆ·å¿…é¡»æœ‰å®‰å…¨çš„å¯†ç 
 * - ç”¨æˆ·åˆ›å»ºæ—¶çŠ¶æ€ä¸ºå¾…æ¿€æ´»
 * - ç”¨æˆ·é‚®ç®±åœ¨ç³»ç»Ÿä¸­å¿…é¡»å”¯ä¸€
 *
 * ### ç”¨æˆ·æ¿€æ´»è§„åˆ™
 * - åªæœ‰å¾…æ¿€æ´»çŠ¶æ€çš„ç”¨æˆ·å¯ä»¥è¢«æ¿€æ´»
 * - ç”¨æˆ·æ¿€æ´»åå¯ä»¥ç™»å½•ç³»ç»Ÿ
 * - ç”¨æˆ·æ¿€æ´»ä¼šå‘å¸ƒç”¨æˆ·æ¿€æ´»äº‹ä»¶
 *
 * ### ç”¨æˆ·çŠ¶æ€è§„åˆ™
 * - ç”¨æˆ·çŠ¶æ€åŒ…æ‹¬ï¼šå¾…æ¿€æ´»ã€æ¿€æ´»ã€ç¦ç”¨ã€é”å®š
 * - çŠ¶æ€è½¬æ¢å¿…é¡»éµå¾ªé¢„å®šä¹‰çš„è§„åˆ™
 * - ç¦ç”¨çŠ¶æ€çš„ç”¨æˆ·ä¸èƒ½ç™»å½•ç³»ç»Ÿ
 * - é”å®šçŠ¶æ€çš„ç”¨æˆ·éœ€è¦ç®¡ç†å‘˜è§£é”
 *
 * @example
 * ```typescript
 * // åˆ›å»ºç”¨æˆ·
 * const user = User.create(
 *   'john@example.com',
 *   'SecurePassword123!',
 *   'John Doe'
 * );
 * 
 * // æ¿€æ´»ç”¨æˆ·
 * user.activate();
 * 
 * // æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
 * if (user.isActive()) {
 *   console.log('ç”¨æˆ·å·²æ¿€æ´»');
 * }
 * ```
 *
 * @since 1.0.0
 */
export class User extends BaseEntity {
  private _email: Email;
  private _password: HashedPassword;
  private _name: string;
  private _status: UserStatus;
  private _lastLoginAt: Date | null = null;
  private _tenantIds: TenantId[] = [];

  /**
   * åˆ›å»ºæ–°ç”¨æˆ·
   *
   * @description åˆ›å»ºæ–°ç”¨æˆ·å®ä¾‹ï¼Œç”¨æˆ·åˆå§‹çŠ¶æ€ä¸ºå¾…æ¿€æ´»
   * æ­¤æ–¹æ³•ä¼šéªŒè¯ç”¨æˆ·ä¿¡æ¯çš„æœ‰æ•ˆæ€§å¹¶è®¾ç½®åˆå§‹çŠ¶æ€
   *
   * @param email - ç”¨æˆ·é‚®ç®±åœ°å€
   * @param plainPassword - ç”¨æˆ·æ˜æ–‡å¯†ç 
   * @param name - ç”¨æˆ·å§“å
   * @returns æ–°åˆ›å»ºçš„ç”¨æˆ·å®ä¾‹
   * @throws {InvalidEmailException} å½“é‚®ç®±æ ¼å¼æ— æ•ˆæ—¶
   * @throws {InvalidPasswordException} å½“å¯†ç ä¸ç¬¦åˆè¦æ±‚æ—¶
   * @throws {UserAlreadyExistsException} å½“ç”¨æˆ·å·²å­˜åœ¨æ—¶
   *
   * @example
   * ```typescript
   * const user = User.create(
   *   'john@example.com',
   *   'SecurePassword123!',
   *   'John Doe'
   * );
   * ```
   */
  static create(
    email: string,
    plainPassword: string,
    name: string
  ): User {
    const userId = UserId.generate();
    const emailValue = new Email(email);
    const hashedPassword = HashedPassword.fromPlainText(plainPassword);

    const user = new User(userId, emailValue, hashedPassword, name);
    user.addDomainEvent(new UserCreatedEvent(userId, email, name));

    return user;
  }

  /**
   * æ„é€ å‡½æ•°
   *
   * @param id - ç”¨æˆ·æ ‡è¯†ç¬¦
   * @param email - ç”¨æˆ·é‚®ç®±
   * @param password - ç”¨æˆ·å¯†ç å“ˆå¸Œ
   * @param name - ç”¨æˆ·å§“å
   * @param status - ç”¨æˆ·çŠ¶æ€ï¼Œé»˜è®¤ä¸ºå¾…æ¿€æ´»
   * @param createdAt - åˆ›å»ºæ—¶é—´
   * @param updatedAt - æ›´æ–°æ—¶é—´
   */
  constructor(
    id: UserId,
    email: Email,
    password: HashedPassword,
    name: string,
    status: UserStatus = UserStatus.Pending,
    createdAt?: Date,
    updatedAt?: Date
  ) {
    super(id, createdAt, updatedAt);
    this._email = email;
    this._password = password;
    this._name = name;
    this._status = status;
  }

  /**
   * æ¿€æ´»ç”¨æˆ·
   *
   * @description å°†ç”¨æˆ·çŠ¶æ€ä»å¾…æ¿€æ´»æ”¹ä¸ºæ¿€æ´»
   * åªæœ‰å¾…æ¿€æ´»çŠ¶æ€çš„ç”¨æˆ·å¯ä»¥è¢«æ¿€æ´»
   *
   * @throws {UserNotPendingException} å½“ç”¨æˆ·ä¸æ˜¯å¾…æ¿€æ´»çŠ¶æ€æ—¶
   *
   * @example
   * ```typescript
   * user.activate();
   * ```
   */
  activate(): void {
    this.ensureIsPending();
    this._status = UserStatus.Active;
    this.updateTimestamp();
    this.addDomainEvent(new UserActivatedEvent(this.id as UserId));
  }

  /**
   * ç¦ç”¨ç”¨æˆ·
   *
   * @description ç¦ç”¨ç”¨æˆ·è´¦æˆ·ï¼Œç”¨æˆ·å°†æ— æ³•ç™»å½•ç³»ç»Ÿ
   * ç¦ç”¨æ“ä½œä¼šå‘å¸ƒç”¨æˆ·ç¦ç”¨äº‹ä»¶
   *
   * @param reason - ç¦ç”¨åŸå› 
   * @throws {UserNotActiveException} å½“ç”¨æˆ·ä¸æ˜¯æ¿€æ´»çŠ¶æ€æ—¶
   *
   * @example
   * ```typescript
   * user.disable('è¿åä½¿ç”¨æ¡æ¬¾');
   * ```
   */
  disable(reason: string): void {
    this.ensureIsActive();
    this._status = UserStatus.Disabled;
    this.updateTimestamp();
    this.addDomainEvent(new UserDisabledEvent(this.id as UserId, reason));
  }

  /**
   * é”å®šç”¨æˆ·
   *
   * @description é”å®šç”¨æˆ·è´¦æˆ·ï¼Œé€šå¸¸ç”±äºå®‰å…¨åŸå› 
   * é”å®šçš„ç”¨æˆ·éœ€è¦ç®¡ç†å‘˜æ‰‹åŠ¨è§£é”
   *
   * @param reason - é”å®šåŸå› 
   * @throws {UserNotActiveException} å½“ç”¨æˆ·ä¸æ˜¯æ¿€æ´»çŠ¶æ€æ—¶
   *
   * @example
   * ```typescript
   * user.lock('å¤šæ¬¡ç™»å½•å¤±è´¥');
   * ```
   */
  lock(reason: string): void {
    this.ensureIsActive();
    this._status = UserStatus.Locked;
    this.updateTimestamp();
    this.addDomainEvent(new UserLockedEvent(this.id as UserId, reason));
  }

  /**
   * è§£é”ç”¨æˆ·
   *
   * @description è§£é”ç”¨æˆ·è´¦æˆ·ï¼Œç”¨æˆ·å¯ä»¥é‡æ–°ç™»å½•
   * åªæœ‰é”å®šçŠ¶æ€çš„ç”¨æˆ·å¯ä»¥è¢«è§£é”
   *
   * @throws {UserNotLockedException} å½“ç”¨æˆ·ä¸æ˜¯é”å®šçŠ¶æ€æ—¶
   *
   * @example
   * ```typescript
   * user.unlock();
   * ```
   */
  unlock(): void {
    this.ensureIsLocked();
    this._status = UserStatus.Active;
    this.updateTimestamp();
    this.addDomainEvent(new UserUnlockedEvent(this.id as UserId));
  }

  /**
   * è®°å½•ç™»å½•æ—¶é—´
   *
   * @description æ›´æ–°ç”¨æˆ·æœ€åç™»å½•æ—¶é—´
   * æ­¤æ–¹æ³•åœ¨ç”¨æˆ·æˆåŠŸç™»å½•åè°ƒç”¨
   *
   * @example
   * ```typescript
   * user.recordLogin();
   * ```
   */
  recordLogin(): void {
    this._lastLoginAt = new Date();
    this.updateTimestamp();
  }

  /**
   * æ›´æ”¹å¯†ç 
   *
   * @description æ›´æ”¹ç”¨æˆ·å¯†ç 
   * éœ€è¦éªŒè¯å½“å‰å¯†ç çš„æ­£ç¡®æ€§
   *
   * @param currentPassword - å½“å‰å¯†ç 
   * @param newPassword - æ–°å¯†ç 
   * @throws {InvalidPasswordException} å½“å½“å‰å¯†ç ä¸æ­£ç¡®æ—¶
   * @throws {InvalidPasswordException} å½“æ–°å¯†ç ä¸ç¬¦åˆè¦æ±‚æ—¶
   *
   * @example
   * ```typescript
   * user.changePassword('OldPassword123!', 'NewPassword123!');
   * ```
   */
  changePassword(currentPassword: string, newPassword: string): void {
    this.ensurePasswordMatches(currentPassword);
    
    const newHashedPassword = HashedPassword.fromPlainText(newPassword);
    this._password = newHashedPassword;
    this.updateTimestamp();
    
    this.addDomainEvent(new UserPasswordChangedEvent(this.id as UserId));
  }

  /**
   * é‡ç½®å¯†ç 
   *
   * @description é‡ç½®ç”¨æˆ·å¯†ç ä¸ºä¸´æ—¶å¯†ç 
   * é‡ç½®åç”¨æˆ·éœ€è¦ç«‹å³æ›´æ”¹å¯†ç 
   *
   * @param temporaryPassword - ä¸´æ—¶å¯†ç 
   * @throws {UserNotActiveException} å½“ç”¨æˆ·ä¸æ˜¯æ¿€æ´»çŠ¶æ€æ—¶
   *
   * @example
   * ```typescript
   * user.resetPassword('TempPassword123!');
   * ```
   */
  resetPassword(temporaryPassword: string): void {
    this.ensureIsActive();
    
    const hashedPassword = HashedPassword.fromPlainText(temporaryPassword);
    this._password = hashedPassword;
    this.updateTimestamp();
    
    this.addDomainEvent(new UserPasswordResetEvent(this.id as UserId));
  }

  /**
   * æ·»åŠ ç§Ÿæˆ·å…³è”
   *
   * @description å°†ç”¨æˆ·å…³è”åˆ°ç§Ÿæˆ·
   * ç”¨æˆ·å¯ä»¥å…³è”åˆ°å¤šä¸ªç§Ÿæˆ·
   *
   * @param tenantId - ç§Ÿæˆ·æ ‡è¯†ç¬¦
   * @throws {UserNotActiveException} å½“ç”¨æˆ·ä¸æ˜¯æ¿€æ´»çŠ¶æ€æ—¶
   *
   * @example
   * ```typescript
   * user.addTenant(tenantId);
   * ```
   */
  addTenant(tenantId: TenantId): void {
    this.ensureIsActive();
    
    if (!this._tenantIds.some(id => id.equals(tenantId))) {
      this._tenantIds.push(tenantId);
      this.updateTimestamp();
      this.addDomainEvent(new UserTenantAddedEvent(this.id as UserId, tenantId));
    }
  }

  /**
   * ç§»é™¤ç§Ÿæˆ·å…³è”
   *
   * @description ç§»é™¤ç”¨æˆ·ä¸ç§Ÿæˆ·çš„å…³è”
   *
   * @param tenantId - ç§Ÿæˆ·æ ‡è¯†ç¬¦
   *
   * @example
   * ```typescript
   * user.removeTenant(tenantId);
   * ```
   */
  removeTenant(tenantId: TenantId): void {
    const index = this._tenantIds.findIndex(id => id.equals(tenantId));
    if (index !== -1) {
      this._tenantIds.splice(index, 1);
      this.updateTimestamp();
      this.addDomainEvent(new UserTenantRemovedEvent(this.id as UserId, tenantId));
    }
  }

  // è·å–å™¨æ–¹æ³•
  get email(): Email {
    return this._email;
  }

  get name(): string {
    return this._name;
  }

  get status(): UserStatus {
    return this._status;
  }

  get lastLoginAt(): Date | null {
    return this._lastLoginAt;
  }

  get tenantIds(): TenantId[] {
    return [...this._tenantIds];
  }

  // çŠ¶æ€æ£€æŸ¥æ–¹æ³•
  isActive(): boolean {
    return this._status === UserStatus.Active;
  }

  isPending(): boolean {
    return this._status === UserStatus.Pending;
  }

  isDisabled(): boolean {
    return this._status === UserStatus.Disabled;
  }

  isLocked(): boolean {
    return this._status === UserStatus.Locked;
  }

  canLogin(): boolean {
    return this._status === UserStatus.Active;
  }

  // ç§æœ‰éªŒè¯æ–¹æ³•
  private ensureIsPending(): void {
    if (this._status !== UserStatus.Pending) {
      throw new UserNotPendingException(this.id as UserId);
    }
  }

  private ensureIsActive(): void {
    if (this._status !== UserStatus.Active) {
      throw new UserNotActiveException(this.id as UserId);
    }
  }

  private ensureIsLocked(): void {
    if (this._status !== UserStatus.Locked) {
      throw new UserNotLockedException(this.id as UserId);
    }
  }

  private ensurePasswordMatches(password: string): void {
    if (!this._password.matches(password)) {
      throw new InvalidPasswordException('å½“å‰å¯†ç ä¸æ­£ç¡®');
    }
  }
}
```

---

## 5. å€¼å¯¹è±¡è®¾è®¡

### 5.1 å€¼å¯¹è±¡åŸºç±»è®¾è®¡

#### BaseValueObject

```typescript
/**
 * å€¼å¯¹è±¡åŸºç±»
 *
 * æ‰€æœ‰å€¼å¯¹è±¡çš„åŸºç±»ï¼Œæä¾›ä¸å¯å˜æ€§å’Œå€¼æ¯”è¾ƒåŠŸèƒ½
 * å€¼å¯¹è±¡æ˜¯æ²¡æœ‰æ ‡è¯†ç¬¦çš„ä¸å¯å˜å¯¹è±¡ï¼Œé€šè¿‡å€¼è¿›è¡Œæ¯”è¾ƒ
 *
 * @description å€¼å¯¹è±¡æ˜¯é¢†åŸŸæ¨¡å‹ä¸­çš„é‡è¦æ¦‚å¿µï¼Œç”¨äºå°è£…å…·æœ‰ä¸šåŠ¡å«ä¹‰çš„å€¼
 * å€¼å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹ï¼Œéœ€è¦ä¿®æ”¹æ—¶åˆ›å»ºæ–°å¯¹è±¡
 *
 * ## ä¸šåŠ¡è§„åˆ™
 *
 * ### ä¸å¯å˜æ€§è§„åˆ™
 * - å€¼å¯¹è±¡ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹
 * - æ‰€æœ‰å±æ€§éƒ½æ˜¯åªè¯»çš„
 * - éœ€è¦ä¿®æ”¹æ—¶åˆ›å»ºæ–°çš„å€¼å¯¹è±¡å®ä¾‹
 * - å€¼å¯¹è±¡çš„çŠ¶æ€åœ¨ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜
 *
 * ### å€¼ç›¸ç­‰æ€§è§„åˆ™
 * - å€¼å¯¹è±¡çš„ç›¸ç­‰æ€§åŸºäºå€¼æ¯”è¾ƒï¼Œè€Œéå¼•ç”¨æ¯”è¾ƒ
 * - ç›¸åŒç±»å‹çš„å€¼å¯¹è±¡ï¼Œå¦‚æœæ‰€æœ‰å±æ€§å€¼ç›¸ç­‰ï¼Œåˆ™å¯¹è±¡ç›¸ç­‰
 * - å€¼å¯¹è±¡å¯ä»¥ç”¨ä½œ Map çš„é”®æˆ– Set çš„å…ƒç´ 
 *
 * ### è‡ªæˆ‘éªŒè¯è§„åˆ™
 * - å€¼å¯¹è±¡åœ¨æ„é€ æ—¶éªŒè¯è‡ªèº«æœ‰æ•ˆæ€§
 * - æ— æ•ˆçš„å€¼å¯¹è±¡ä¸èƒ½åˆ›å»º
 * - éªŒè¯è§„åˆ™å°è£…åœ¨å€¼å¯¹è±¡å†…éƒ¨
 *
 * @example
 * ```typescript
 * class Email extends BaseValueObject {
 *   private readonly _value: string;
 *   
 *   constructor(value: string) {
 *     super();
 *     this.validate(value);
 *     this._value = value.toLowerCase().trim();
 *   }
 *   
 *   get value(): string {
 *     return this._value;
 *   }
 *   
 *   protected validate(value: string): void {
 *     if (!this.isValidEmail(value)) {
 *       throw new InvalidEmailException(value);
 *     }
 *   }
 *   
 *   private isValidEmail(value: string): boolean {
 *     const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
 *     return emailRegex.test(value);
 *   }
 * }
 * 
 * // ä½¿ç”¨ç¤ºä¾‹
 * const email1 = new Email('john@example.com');
 * const email2 = new Email('JOHN@EXAMPLE.COM');
 * 
 * console.log(email1.equals(email2)); // true (å€¼ç›¸ç­‰)
 * ```
 *
 * @since 1.0.0
 */
export abstract class BaseValueObject {
  /**
   * æ£€æŸ¥å€¼å¯¹è±¡æ˜¯å¦ç›¸ç­‰
   *
   * @param other - è¦æ¯”è¾ƒçš„å¦ä¸€ä¸ªå€¼å¯¹è±¡
   * @returns å¦‚æœå€¼å¯¹è±¡ç›¸ç­‰è¿”å›trueï¼Œå¦åˆ™è¿”å›false
   */
  equals(other: BaseValueObject | null | undefined): boolean {
    if (other === null || other === undefined) {
      return false;
    }

    if (this === other) {
      return true;
    }

    if (this.constructor !== other.constructor) {
      return false;
    }

    return this.getValueEquality(other);
  }

  /**
   * è·å–å€¼ç›¸ç­‰æ€§æ¯”è¾ƒ
   *
   * @description å­ç±»éœ€è¦å®ç°æ­¤æ–¹æ³•ï¼Œå®šä¹‰å¦‚ä½•æ¯”è¾ƒå€¼å¯¹è±¡çš„ç›¸ç­‰æ€§
   * é€šå¸¸æ¯”è¾ƒæ‰€æœ‰å±æ€§çš„å€¼
   *
   * @param other - è¦æ¯”è¾ƒçš„å¦ä¸€ä¸ªå€¼å¯¹è±¡
   * @returns å¦‚æœå€¼ç›¸ç­‰è¿”å›trueï¼Œå¦åˆ™è¿”å›false
   */
  protected abstract getValueEquality(other: BaseValueObject): boolean;

  /**
   * è·å–å“ˆå¸Œå€¼
   *
   * @description å­ç±»éœ€è¦å®ç°æ­¤æ–¹æ³•ï¼Œè¿”å›åŸºäºå€¼çš„å“ˆå¸Œç 
   * ç›¸ç­‰çš„å€¼å¯¹è±¡å¿…é¡»è¿”å›ç›¸åŒçš„å“ˆå¸Œç 
   *
   * @returns å“ˆå¸Œå€¼
   */
  abstract hashCode(): string;

  /**
   * è½¬æ¢ä¸ºå­—ç¬¦ä¸²
   *
   * @returns å€¼å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤º
   */
  abstract toString(): string;
}
```

### 5.2 å…·ä½“å€¼å¯¹è±¡ç¤ºä¾‹

#### Email å€¼å¯¹è±¡

```typescript
/**
 * é‚®ç®±åœ°å€å€¼å¯¹è±¡
 *
 * å°è£…é‚®ç®±åœ°å€çš„ä¸šåŠ¡è§„åˆ™å’ŒéªŒè¯é€»è¾‘
 * é‚®ç®±åœ°å€åœ¨ç³»ç»Ÿä¸­å¿…é¡»å”¯ä¸€ä¸”æœ‰æ•ˆ
 *
 * @description é‚®ç®±åœ°å€æ˜¯ç”¨æˆ·èº«ä»½çš„é‡è¦æ ‡è¯†ï¼Œéœ€è¦ä¸¥æ ¼çš„æ ¼å¼éªŒè¯
 * é‚®ç®±åœ°å€ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå°å†™å¹¶å»é™¤ç©ºæ ¼ï¼Œç¡®ä¿ä¸€è‡´æ€§
 *
 * ## ä¸šåŠ¡è§„åˆ™
 *
 * ### æ ¼å¼éªŒè¯è§„åˆ™
 * - å¿…é¡»ç¬¦åˆæ ‡å‡†é‚®ç®±æ ¼å¼
 * - ä¸èƒ½åŒ…å«æ— æ•ˆå­—ç¬¦
 * - åŸŸåéƒ¨åˆ†å¿…é¡»æœ‰æ•ˆ
 * - é•¿åº¦ä¸èƒ½è¶…è¿‡é™åˆ¶
 *
 * ### æ ‡å‡†åŒ–è§„åˆ™
 * - è‡ªåŠ¨è½¬æ¢ä¸ºå°å†™
 * - å»é™¤å‰åç©ºæ ¼
 * - ç»Ÿä¸€æ ¼å¼è¡¨ç¤º
 *
 * ### å”¯ä¸€æ€§è§„åˆ™
 * - é‚®ç®±åœ°å€åœ¨ç³»ç»Ÿä¸­å¿…é¡»å”¯ä¸€
 * - ç›¸åŒé‚®ç®±çš„ä¸åŒè¡¨ç¤ºå½¢å¼è¢«è§†ä¸ºç›¸åŒ
 *
 * @example
 * ```typescript
 * // åˆ›å»ºé‚®ç®±åœ°å€
 * const email = new Email('john.doe@example.com');
 * 
 * // éªŒè¯æ ¼å¼
 * const invalidEmail = new Email('invalid-email'); // æŠ›å‡ºå¼‚å¸¸
 * 
 * // æ ‡å‡†åŒ–
 * const email1 = new Email('JOHN@EXAMPLE.COM');
 * const email2 = new Email('john@example.com');
 * console.log(email1.equals(email2)); // true
 * ```
 *
 * @since 1.0.0
 */
export class Email extends BaseValueObject {
  private readonly _value: string;

  /**
   * æ„é€ å‡½æ•°
   *
   * @param value - é‚®ç®±åœ°å€å­—ç¬¦ä¸²
   * @throws {InvalidEmailException} å½“é‚®ç®±æ ¼å¼æ— æ•ˆæ—¶
   */
  constructor(value: string) {
    super();
    this.validate(value);
    this._value = this.normalize(value);
  }

  /**
   * è·å–é‚®ç®±åœ°å€å€¼
   *
   * @returns æ ‡å‡†åŒ–åçš„é‚®ç®±åœ°å€
   */
  get value(): string {
    return this._value;
  }

  /**
   * è·å–é‚®ç®±ç”¨æˆ·åéƒ¨åˆ†
   *
   * @returns é‚®ç®±åœ°å€ä¸­@ç¬¦å·å‰çš„éƒ¨åˆ†
   */
  get username(): string {
    return this._value.split('@')[0];
  }

  /**
   * è·å–é‚®ç®±åŸŸåéƒ¨åˆ†
   *
   * @returns é‚®ç®±åœ°å€ä¸­@ç¬¦å·åçš„éƒ¨åˆ†
   */
  get domain(): string {
    return this._value.split('@')[1];
  }

  /**
   * éªŒè¯é‚®ç®±æ ¼å¼
   *
   * @param value - è¦éªŒè¯çš„é‚®ç®±åœ°å€
   * @throws {InvalidEmailException} å½“é‚®ç®±æ ¼å¼æ— æ•ˆæ—¶
   */
  private validate(value: string): void {
    if (!value || typeof value !== 'string') {
      throw new InvalidEmailException('é‚®ç®±åœ°å€ä¸èƒ½ä¸ºç©º');
    }

    if (value.length > 254) {
      throw new InvalidEmailException('é‚®ç®±åœ°å€é•¿åº¦ä¸èƒ½è¶…è¿‡254ä¸ªå­—ç¬¦');
    }

    if (!this.isValidEmailFormat(value)) {
      throw new InvalidEmailException(`æ— æ•ˆçš„é‚®ç®±æ ¼å¼: ${value}`);
    }
  }

  /**
   * æ ‡å‡†åŒ–é‚®ç®±åœ°å€
   *
   * @param value - åŸå§‹é‚®ç®±åœ°å€
   * @returns æ ‡å‡†åŒ–åçš„é‚®ç®±åœ°å€
   */
  private normalize(value: string): string {
    return value.toLowerCase().trim();
  }

  /**
   * éªŒè¯é‚®ç®±æ ¼å¼
   *
   * @param email - é‚®ç®±åœ°å€
   * @returns å¦‚æœæ ¼å¼æœ‰æ•ˆè¿”å›trueï¼Œå¦åˆ™è¿”å›false
   */
  private isValidEmailFormat(email: string): boolean {
    // RFC 5322 å…¼å®¹çš„é‚®ç®±æ­£åˆ™è¡¨è¾¾å¼
    const emailRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
    return emailRegex.test(email);
  }

  /**
   * è·å–å€¼ç›¸ç­‰æ€§æ¯”è¾ƒ
   *
   * @param other - è¦æ¯”è¾ƒçš„å¦ä¸€ä¸ªå€¼å¯¹è±¡
   * @returns å¦‚æœå€¼ç›¸ç­‰è¿”å›trueï¼Œå¦åˆ™è¿”å›false
   */
  protected getValueEquality(other: BaseValueObject): boolean {
    return other instanceof Email && this._value === other._value;
  }

  /**
   * è·å–å“ˆå¸Œå€¼
   *
   * @returns åŸºäºé‚®ç®±åœ°å€å€¼çš„å“ˆå¸Œç 
   */
  hashCode(): string {
    return this._value;
  }

  /**
   * è½¬æ¢ä¸ºå­—ç¬¦ä¸²
   *
   * @returns é‚®ç®±åœ°å€çš„å­—ç¬¦ä¸²è¡¨ç¤º
   */
  toString(): string {
    return this._value;
  }
}
```

#### Money å€¼å¯¹è±¡

```typescript
/**
 * é‡‘é¢å€¼å¯¹è±¡
 *
 * å°è£…é‡‘é¢çš„è®¡ç®—å’ŒéªŒè¯é€»è¾‘
 * æ”¯æŒä¸åŒè´§å¸çš„é‡‘é¢è¿ç®—å’Œæ¯”è¾ƒ
 *
 * @description é‡‘é¢æ˜¯é‡‘èç³»ç»Ÿä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œéœ€è¦ç²¾ç¡®çš„è®¡ç®—å’Œå®‰å…¨çš„æ“ä½œ
 * é‡‘é¢ä½¿ç”¨æ•´æ•°å­˜å‚¨ä»¥é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜
 *
 * ## ä¸šåŠ¡è§„åˆ™
 *
 * ### ç²¾åº¦è§„åˆ™
 * - ä½¿ç”¨æ•´æ•°å­˜å‚¨ï¼Œé¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜
 * - æ”¯æŒä¸åŒçš„å°æ•°ä½æ•°
 * - è®¡ç®—æ—¶ä¿æŒç²¾åº¦
 *
 * ### è´§å¸è§„åˆ™
 * - åªèƒ½ä¸ç›¸åŒè´§å¸çš„é‡‘é¢è¿›è¡Œè¿ç®—
 * - æ”¯æŒå¤šç§è´§å¸ç±»å‹
 * - è´§å¸è½¬æ¢éœ€è¦ç‰¹æ®Šå¤„ç†
 *
 * ### è¿ç®—è§„åˆ™
 * - æ”¯æŒåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•ã€é™¤æ³•
 * - é™¤æ³•è¿ç®—å¯èƒ½äº§ç”Ÿç²¾åº¦æŸå¤±
 * - è¿ç®—ç»“æœåˆ›å»ºæ–°çš„é‡‘é¢å¯¹è±¡
 *
 * @example
 * ```typescript
 * // åˆ›å»ºé‡‘é¢
 * const amount1 = new Money(10000, Currency.CNY); // 100.00 CNY
 * const amount2 = new Money(5000, Currency.CNY);  // 50.00 CNY
 * 
 * // è¿ç®—
 * const sum = amount1.add(amount2); // 150.00 CNY
 * const diff = amount1.subtract(amount2); // 50.00 CNY
 * 
 * // æ¯”è¾ƒ
 * console.log(amount1.isGreaterThan(amount2)); // true
 * ```
 *
 * @since 1.0.0
 */
export class Money extends BaseValueObject {
  private readonly _amount: number;
  private readonly _currency: Currency;

  /**
   * æ„é€ å‡½æ•°
   *
   * @param amount - é‡‘é¢æ•°é‡ï¼ˆä»¥æœ€å°å•ä½è®¡ç®—ï¼Œå¦‚åˆ†ä¸ºå•ä½ï¼‰
   * @param currency - è´§å¸ç±»å‹
   * @throws {InvalidAmountException} å½“é‡‘é¢æ— æ•ˆæ—¶
   */
  constructor(amount: number, currency: Currency) {
    super();
    this.validate(amount, currency);
    this._amount = Math.round(amount);
    this._currency = currency;
  }

  /**
   * ä»å­—ç¬¦ä¸²åˆ›å»ºé‡‘é¢
   *
   * @param amountStr - é‡‘é¢å­—ç¬¦ä¸²ï¼ˆå¦‚ "100.50"ï¼‰
   * @param currency - è´§å¸ç±»å‹
   * @returns é‡‘é¢å¯¹è±¡
   */
  static fromString(amountStr: string, currency: Currency): Money {
    const amount = parseFloat(amountStr);
    if (isNaN(amount)) {
      throw new InvalidAmountException(`æ— æ•ˆçš„é‡‘é¢å­—ç¬¦ä¸²: ${amountStr}`);
    }
    return new Money(amount * 100, currency); // è½¬æ¢ä¸ºåˆ†
  }

  /**
   * è·å–é‡‘é¢æ•°é‡
   *
   * @returns é‡‘é¢æ•°é‡ï¼ˆä»¥æœ€å°å•ä½è®¡ç®—ï¼‰
   */
  get amount(): number {
    return this._amount;
  }

  /**
   * è·å–è´§å¸ç±»å‹
   *
   * @returns è´§å¸ç±»å‹
   */
  get currency(): Currency {
    return this._currency;
  }

  /**
   * è·å–æ˜¾ç¤ºé‡‘é¢
   *
   * @returns æ˜¾ç¤ºç”¨çš„é‡‘é¢ï¼ˆä»¥å…ƒä¸ºå•ä½ï¼‰
   */
  get displayAmount(): number {
    return this._amount / 100;
  }

  /**
   * éªŒè¯é‡‘é¢
   *
   * @param amount - é‡‘é¢æ•°é‡
   * @param currency - è´§å¸ç±»å‹
   * @throws {InvalidAmountException} å½“é‡‘é¢æ— æ•ˆæ—¶
   */
  private validate(amount: number, currency: Currency): void {
    if (typeof amount !== 'number' || isNaN(amount)) {
      throw new InvalidAmountException('é‡‘é¢å¿…é¡»æ˜¯æœ‰æ•ˆæ•°å­—');
    }

    if (!Number.isFinite(amount)) {
      throw new InvalidAmountException('é‡‘é¢å¿…é¡»æ˜¯æœ‰é™æ•°å­—');
    }

    if (amount < 0) {
      throw new InvalidAmountException('é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°');
    }

    if (!currency) {
      throw new InvalidAmountException('è´§å¸ç±»å‹ä¸èƒ½ä¸ºç©º');
    }
  }

  /**
   * åŠ æ³•è¿ç®—
   *
   * @param other - è¦ç›¸åŠ çš„é‡‘é¢
   * @returns æ–°çš„é‡‘é¢å¯¹è±¡
   * @throws {CurrencyMismatchException} å½“è´§å¸ç±»å‹ä¸åŒ¹é…æ—¶
   */
  add(other: Money): Money {
    this.ensureSameCurrency(other);
    return new Money(this._amount + other._amount, this._currency);
  }

  /**
   * å‡æ³•è¿ç®—
   *
   * @param other - è¦ç›¸å‡çš„é‡‘é¢
   * @returns æ–°çš„é‡‘é¢å¯¹è±¡
   * @throws {CurrencyMismatchException} å½“è´§å¸ç±»å‹ä¸åŒ¹é…æ—¶
   */
  subtract(other: Money): Money {
    this.ensureSameCurrency(other);
    return new Money(this._amount - other._amount, this._currency);
  }

  /**
   * ä¹˜æ³•è¿ç®—
   *
   * @param multiplier - ä¹˜æ•°
   * @returns æ–°çš„é‡‘é¢å¯¹è±¡
   */
  multiply(multiplier: number): Money {
    return new Money(this._amount * multiplier, this._currency);
  }

  /**
   * é™¤æ³•è¿ç®—
   *
   * @param divisor - é™¤æ•°
   * @returns æ–°çš„é‡‘é¢å¯¹è±¡
   * @throws {InvalidAmountException} å½“é™¤æ•°ä¸º0æ—¶
   */
  divide(divisor: number): Money {
    if (divisor === 0) {
      throw new InvalidAmountException('é™¤æ•°ä¸èƒ½ä¸º0');
    }
    return new Money(Math.round(this._amount / divisor), this._currency);
  }

  /**
   * æ£€æŸ¥æ˜¯å¦å¤§äºæŒ‡å®šé‡‘é¢
   *
   * @param other - è¦æ¯”è¾ƒçš„é‡‘é¢
   * @returns å¦‚æœå¤§äºè¿”å›trueï¼Œå¦åˆ™è¿”å›false
   * @throws {CurrencyMismatchException} å½“è´§å¸ç±»å‹ä¸åŒ¹é…æ—¶
   */
  isGreaterThan(other: Money): boolean {
    this.ensureSameCurrency(other);
    return this._amount > other._amount;
  }

  /**
   * æ£€æŸ¥æ˜¯å¦å°äºæŒ‡å®šé‡‘é¢
   *
   * @param other - è¦æ¯”è¾ƒçš„é‡‘é¢
   * @returns å¦‚æœå°äºè¿”å›trueï¼Œå¦åˆ™è¿”å›false
   * @throws {CurrencyMismatchException} å½“è´§å¸ç±»å‹ä¸åŒ¹é…æ—¶
   */
  isLessThan(other: Money): boolean {
    this.ensureSameCurrency(other);
    return this._amount < other._amount;
  }

  /**
   * æ£€æŸ¥æ˜¯å¦ç­‰äºæŒ‡å®šé‡‘é¢
   *
   * @param other - è¦æ¯”è¾ƒçš„é‡‘é¢
   * @returns å¦‚æœç­‰äºè¿”å›trueï¼Œå¦åˆ™è¿”å›false
   * @throws {CurrencyMismatchException} å½“è´§å¸ç±»å‹ä¸åŒ¹é…æ—¶
   */
  isEqualTo(other: Money): boolean {
    this.ensureSameCurrency(other);
    return this._amount === other._amount;
  }

  /**
   * æ£€æŸ¥æ˜¯å¦ä¸ºé›¶
   *
   * @returns å¦‚æœä¸ºé›¶è¿”å›trueï¼Œå¦åˆ™è¿”å›false
   */
  isZero(): boolean {
    return this._amount === 0;
  }

  /**
   * è·å–ç»å¯¹å€¼
   *
   * @returns ç»å¯¹å€¼é‡‘é¢
   */
  abs(): Money {
    return new Money(Math.abs(this._amount), this._currency);
  }

  /**
   * ç¡®ä¿è´§å¸ç±»å‹ç›¸åŒ
   *
   * @param other - è¦æ¯”è¾ƒçš„é‡‘é¢
   * @throws {CurrencyMismatchException} å½“è´§å¸ç±»å‹ä¸åŒ¹é…æ—¶
   */
  private ensureSameCurrency(other: Money): void {
    if (this._currency !== other._currency) {
      throw new CurrencyMismatchException(
        `è´§å¸ç±»å‹ä¸åŒ¹é…: ${this._currency} vs ${other._currency}`
      );
    }
  }

  /**
   * è·å–å€¼ç›¸ç­‰æ€§æ¯”è¾ƒ
   *
   * @param other - è¦æ¯”è¾ƒçš„å¦ä¸€ä¸ªå€¼å¯¹è±¡
   * @returns å¦‚æœå€¼ç›¸ç­‰è¿”å›trueï¼Œå¦åˆ™è¿”å›false
   */
  protected getValueEquality(other: BaseValueObject): boolean {
    return other instanceof Money && 
           this._amount === other._amount && 
           this._currency === other._currency;
  }

  /**
   * è·å–å“ˆå¸Œå€¼
   *
   * @returns åŸºäºé‡‘é¢å’Œè´§å¸çš„å“ˆå¸Œç 
   */
  hashCode(): string {
    return `${this._amount}-${this._currency}`;
  }

  /**
   * è½¬æ¢ä¸ºå­—ç¬¦ä¸²
   *
   * @returns é‡‘é¢çš„å­—ç¬¦ä¸²è¡¨ç¤º
   */
  toString(): string {
    return `${this.displayAmount.toFixed(2)} ${this._currency}`;
  }
}
```

### 5.3 æšä¸¾å€¼å¯¹è±¡

#### UserStatus æšä¸¾

```typescript
/**
 * ç”¨æˆ·çŠ¶æ€æšä¸¾
 *
 * å®šä¹‰ç”¨æˆ·çš„æ‰€æœ‰å¯èƒ½çŠ¶æ€
 * ç”¨æˆ·çŠ¶æ€æ§åˆ¶ç”¨æˆ·çš„è¡Œä¸ºå’Œæƒé™
 *
 * @description ç”¨æˆ·çŠ¶æ€æ˜¯ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸçš„é‡è¦æ¦‚å¿µ
 * çŠ¶æ€è½¬æ¢å¿…é¡»éµå¾ªé¢„å®šä¹‰çš„ä¸šåŠ¡è§„åˆ™
 *
 * ## ä¸šåŠ¡è§„åˆ™
 *
 * ### çŠ¶æ€å®šä¹‰
 * - Pending: å¾…æ¿€æ´»çŠ¶æ€ï¼Œç”¨æˆ·å·²åˆ›å»ºä½†æœªæ¿€æ´»
 * - Active: æ¿€æ´»çŠ¶æ€ï¼Œç”¨æˆ·å¯ä»¥æ­£å¸¸ä½¿ç”¨ç³»ç»Ÿ
 * - Disabled: ç¦ç”¨çŠ¶æ€ï¼Œç”¨æˆ·è¢«ç®¡ç†å‘˜ç¦ç”¨
 * - Locked: é”å®šçŠ¶æ€ï¼Œç”¨æˆ·å› å®‰å…¨åŸå› è¢«é”å®š
 *
 * ### çŠ¶æ€è½¬æ¢è§„åˆ™
 * - Pending â†’ Active: ç”¨æˆ·æ¿€æ´»
 * - Active â†’ Disabled: ç®¡ç†å‘˜ç¦ç”¨ç”¨æˆ·
 * - Active â†’ Locked: ç³»ç»Ÿè‡ªåŠ¨é”å®šï¼ˆå¦‚å¤šæ¬¡ç™»å½•å¤±è´¥ï¼‰
 * - Disabled â†’ Active: ç®¡ç†å‘˜é‡æ–°å¯ç”¨
 * - Locked â†’ Active: ç®¡ç†å‘˜è§£é”
 *
 * @example
 * ```typescript
 * // æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
 * if (user.status === UserStatus.Active) {
 *   console.log('ç”¨æˆ·å¯ä»¥ç™»å½•');
 * }
 * 
 * // çŠ¶æ€è½¬æ¢
 * user.activate(); // Pending â†’ Active
 * user.disable('è¿åä½¿ç”¨æ¡æ¬¾'); // Active â†’ Disabled
 * ```
 *
 * @since 1.0.0
 */
export enum UserStatus {
  /**
   * å¾…æ¿€æ´»çŠ¶æ€
   * 
   * ç”¨æˆ·å·²åˆ›å»ºä½†å°šæœªæ¿€æ´»ï¼Œä¸èƒ½ç™»å½•ç³»ç»Ÿ
   * éœ€è¦ç®¡ç†å‘˜æ¿€æ´»æˆ–ç”¨æˆ·é€šè¿‡é‚®ç®±éªŒè¯æ¿€æ´»
   */
  Pending = 'pending',

  /**
   * æ¿€æ´»çŠ¶æ€
   * 
   * ç”¨æˆ·å¯ä»¥æ­£å¸¸ä½¿ç”¨ç³»ç»Ÿï¼Œå…·æœ‰å®Œæ•´çš„æƒé™
   * è¿™æ˜¯ç”¨æˆ·çš„æ­£å¸¸å·¥ä½œçŠ¶æ€
   */
  Active = 'active',

  /**
   * ç¦ç”¨çŠ¶æ€
   * 
   * ç”¨æˆ·è¢«ç®¡ç†å‘˜ç¦ç”¨ï¼Œä¸èƒ½ç™»å½•ç³»ç»Ÿ
   * ç¦ç”¨é€šå¸¸æ˜¯ç”±äºè¿åä½¿ç”¨æ¡æ¬¾æˆ–å…¶ä»–ç®¡ç†åŸå› 
   */
  Disabled = 'disabled',

  /**
   * é”å®šçŠ¶æ€
   * 
   * ç”¨æˆ·å› å®‰å…¨åŸå› è¢«ç³»ç»Ÿé”å®š
   * é”å®šé€šå¸¸æ˜¯ç”±äºå¤šæ¬¡ç™»å½•å¤±è´¥æˆ–å…¶ä»–å®‰å…¨å¨èƒ
   */
  Locked = 'locked'
}
```

---

**è¿”å›**: [æ¶æ„æ–‡æ¡£ä¸­å¿ƒ](./README.md)
